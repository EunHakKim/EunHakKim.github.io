---
title: "ë§›ë™ì‚°ğŸ…Â ë™í™” ìºì‹œ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°"
date: 2024-12-10 03:42:00 +09:00
categories: [í”„ë¡œì íŠ¸]
tags: [ë°±ì—”ë“œ, ìŠ¤í”„ë§, Redis, ìºì‹œ]
image:
  path: /assets/img/thumbnail/cache.png
---

## ë„ì… ë°°ê²½

![Image](https://github.com/user-attachments/assets/34591745-2e1e-4b39-96a0-76f89b019571)

`ë§›ë™ì‚°`ğŸ…ì€Â ì•„ì´ ë§ì¶¤í˜• ë™í™”ë¥¼ ìƒì„±í•˜ê³ , ì•„ì´ì—ê²Œ ë™í™”ë¥¼ ë“¤ë ¤ì£¼ë©° ì§ì ‘ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ì „ìš© ì¸í˜• ë””ë°”ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤.

ì²˜ìŒ AIê°€ ì•„ì´ì˜ ë‚˜ì´, ì–¸ì–´, ì£¼ì–´ì§„ í”„ë¡¬í”„íŠ¸ì— ë§ê²Œ ë™í™”ë¥¼ ìƒì„±í•´ì„œ ì œê³µí•˜ë©´ ê·¸ ì´í›„ì— ìœ ì €ë“¤ì€ ìƒì„±ëœ ë™í™”ë¥¼ ê³µìœ í•˜ê±°ë‚˜ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

ì´ë ‡ë“¯, ë™í™”ê°€ ì‚¬ìš©ì ë§ì¶¤í˜•ìœ¼ë¡œ AIì— ì˜í•´ ìƒì„±ë˜ê¸° ë•Œë¬¸ì— ì²˜ìŒ ìƒì„± ì´í›„, ìˆ˜ì • & ì‚­ì œ ìš”ì²­ì´ ë§¤ìš° ì ê³  ì¡°íšŒ ìš”ì²­ì´ ë§ì„ ê²ƒì´ë¼ëŠ” ì ì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ë˜í•œ ì¸ê¸° ë™í™”, ìµœê·¼ ìƒì„±ëœ ë™í™” ë¦¬ìŠ¤íŠ¸ ë“±ì„ ì œê³µí•˜ë©´ì„œ íŠ¹ì • ë™í™”ë¡œì˜ ì¡°íšŒê°€ ëª°ë¦´ ìˆ˜ ìˆì„ ê²ƒì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

> **ì´ì— ë™í™” ìºì‹œ ì‹œìŠ¤í…œ ë„ì…ì„ ê²°ì •í•˜ê²Œ ë˜ì—ˆë‹¤.**

---

## ìºì‹œë€?

ë³¸ê²©ì ìœ¼ë¡œ ìºì‹œ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê¸°ì— ì•ì„œ ë¨¼ì € ìºì‹œë€ ë¬´ì—‡ì¸ì§€ì— ëŒ€í•´ì„œ ê°„ëµí•˜ê²Œ ì‚´í´ë³´ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

![Image](https://github.com/user-attachments/assets/a14635ea-7c3f-43a4-8853-269a72fd25d6)

**ìºì‹œë€ ë¬´ì—‡ì¼ê¹Œ?**

> **ì»´í“¨í„° ê³¼í•™ì—ì„œ ë°ì´í„°ë‚˜ ê°’ì„ ë¯¸ë¦¬ ë³µì‚¬í•´ ë†“ëŠ” ì„ì‹œ ì¥ì†Œ**

**ìºì‹œ**ëŠ”Â ì»´í“¨í„° ê³¼í•™ì—ì„œ ë°ì´í„°ë‚˜ ê°’ì„ ë¯¸ë¦¬ ë³µì‚¬í•´ ë†“ëŠ” ì„ì‹œ ì¥ì†Œë¥¼ ê°€ë¦¬í‚¤ë©° ë°ì´í„°ì— ì ‘ê·¼í•˜ëŠ” ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ê²½ìš°ë‚˜ ê°’ì„ ë‹¤ì‹œ ê³„ì‚°í•˜ëŠ” ì‹œê°„ì„ ì ˆì•½í•˜ê³  ì‹¶ì€ ê²½ìš°ì— ì‚¬ìš©í•œë‹¤.

ë˜í•œ ìºì‹œì˜ ì¢…ë¥˜ë¡œëŠ” CPU ìºì‹œ, ì›¹ ìºì‹œ, ë¸Œë¼ìš°ì € ìºì‹œ, ì–´í”Œë¦¬ì¼€ì´ì…˜ ìºì‹œ ë“±ë“± ì—¬ëŸ¬ ì¢…ë¥˜ê°€ ìˆìœ¼ë©° ì»´í“¨í„° ê³¼í•™ ì „ë°˜ì—ì„œ ìºì‹œê°€ ì‚¬ìš©ë˜ê³  ìˆë‹¤ê³  í•´ë„ ê³¼ì–¸ì´ ì•„ë‹ˆë‹¤.

ì´ë•Œ ìºì‹œê°€ íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•˜ë ¤ë©´ ìºì‹œì— ì €ì¥í•  ë°ì´í„°ê°€ ì§€ì—­ì„±ì„ ê°€ì ¸ì•¼ í•œë‹¤.

- ì‹œê°„ì  ì§€ì—­ì„±
    - íŠ¹ì • ë°ì´í„°ê°€ í•œë²ˆ ì ‘ê·¼ë˜ì—ˆì„ ê²½ìš°, ê°€ê¹Œìš´ ë¯¸ë˜ì— ë˜ í•œë²ˆ ë°ì´í„°ì— ì ‘ê·¼í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ê²ƒ
- ê³µê°„ì  ì§€ì—­ì„±
    - íŠ¹ì • ë°ì´í„°ì™€ ê°€ê¹Œìš´ ì£¼ì†Œê°€ ìˆœì„œëŒ€ë¡œ ì ‘ê·¼ë˜ì—ˆì„ ê²½ìš°

![Image](https://github.com/user-attachments/assets/89aacdf5-5a78-4404-a8ac-90d5ea85fd39)

ë˜í•œ ìºì‹œ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ”ë°ì—ëŠ” ë‹¤ì–‘í•œ ì „ëµì´ ìˆì„ ìˆ˜ ìˆë‹¤.

- ì½ê¸° ì „ëµ â€“ Look Aside ì „ëµ
    
    ![Image](https://github.com/user-attachments/assets/672e5223-1283-4007-9842-baf0eca4995d)
    
- ì½ê¸° ì „ëµ â€“ Read Through ì „ëµ
    
    ![Image](https://github.com/user-attachments/assets/192987b2-99b2-4783-a1d1-d678960d4708)
    
- ì“°ê¸° ì „ëµ â€“ Write Back ì „ëµ
    
    ![Image](https://github.com/user-attachments/assets/3ed5a8db-6b01-4f2a-bb4d-86f48809963f)
    
- ì“°ê¸° ì „ëµ â€“ Write Through ì „ëµ
    
    ![Image](https://github.com/user-attachments/assets/832e2895-21d9-417f-86e7-ae71fe957991)
    
- ì“°ê¸° ì „ëµ â€“ Write Around ì „ëµ
    
    ![Image](https://github.com/user-attachments/assets/ab545580-aa24-474f-8349-b05be3cccfab)
    

---

## Redisë¥¼ í™œìš©í•œ ìºì‹œ ì‹œìŠ¤í…œ êµ¬ì¶•í•˜ê¸°

ìŠ¤í”„ë§ì—ì„œ ìºì‹œ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ” ë°©ë²•ìœ¼ë¡œëŠ” ì—¬ëŸ¬ê°€ì§€ê°€ ìˆì§€ë§Œ ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìµìˆ™í•œ Redisë¥¼ í™œìš©í•˜ì—¬ì„œ ì§„í–‰í•´ ë³´ì•˜ë‹¤.

Cacheë¥¼ ì‚¬ìš©í•˜ê¸°ì— ì•ì„œ ì–´ë– í•œ ì „ëµìœ¼ë¡œ ì ìš©í•˜ì—¬ ì„±ëŠ¥ì„ ê°œì„ í• ì§€ ê³ ë¯¼í•´ë³´ì•„ì•¼ í•˜ëŠ”ë°, ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” ìºì‹œì˜ ì½ê¸° ì „ëµìœ¼ë¡œ Read Through ì „ëµì„, ì“°ê¸° ì „ëµìœ¼ë¡œëŠ” Write Through ì „ëµì„ ì‚¬ìš©í•˜ì˜€ë‹¤.

### RedisConfig.java

```java
@Configuration
@EnableCaching
public class RedisConfig {

    @Bean
    public CacheManager customCacheManager(RedisConnectionFactory redisConnectionFactory) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                .entryTtl(Duration.ofMinutes(15))
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(new StringRedisSerializer()))
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(new GenericJackson2JsonRedisSerializer()));

        return RedisCacheManager.builder(redisConnectionFactory)
                .cacheDefaults(config)
                .build();
    }
}
```

ë¨¼ì € RedisConfigì—ì„œ ìºì‹œì™€ ê´€ë ¨ëœ ì„¤ì •ì„ ì§„í–‰í•´ì£¼ì—ˆë‹¤. ì—¬ê¸°ì„œ TTL, ìºì‹œí‚¤ì™€ ìºì‹œê°’ì˜ ì§ë ¬í™” ë°©ì‹ ë“± ìºì‹± ì •ì±…ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

- entryTtl: ìºì‹œì˜ TTL ì„¤ì •
- serializeKeysWith: ìºì‹œí‚¤ì˜ ì§ë ¬í™” ë°©ì‹
- serializeValuesWith: ìºì‹œê°’ì˜ ì§ë ¬í™” ë°©ì‹

### MatdongsanServerApplication.java

```java
@SpringBootApplication
@EnableFeignClients
@EnableCaching
public class MatdongsanServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(MatdongsanServerApplication.class, args);
    }
}
```

ë‹¤ìŒìœ¼ë¡œëŠ” ì„œë²„ë¥¼ ì‹¤í–‰ì‹œí‚¤ëŠ” SpringBoot Starter classì— @EnableCaching ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ì„œ ìºì‹œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ì—ˆë‹¤.

### StoryCacheService.java

```java
@Service
@RequiredArgsConstructor
public class StoryCacheService {

    private final StoryRepository storyRepository;

    @Cacheable(value = "stories", key = "#storyId", cacheManager = "customCacheManager")
    public Story getStory(String storyId) {
        return storyRepository.findByIdOrThrow(storyId);
    }

    @CachePut(value = "stories", key = "#storyId", cacheManager = "customCacheManager")
    public Story updateStory(String storyId, StoryDto.StoryUpdateRequest requestDto) {
        return storyRepository.findByIdOrThrow(storyId)
                .updateStoryDetail(requestDto);
    }

    @CachePut(value = "stories", key = "#storyId", cacheManager = "customCacheManager")
    public Story likeStory(String storyId) {
        return storyRepository.findByIdOrThrow(storyId)
                .addLikes();
    }

    @CachePut(value = "stories", key = "#storyId", cacheManager = "customCacheManager")
    public Story unlikeStory(String storyId) {
        return storyRepository.findByIdOrThrow(storyId)
                .removeLikes();
    }
}
```

ìºì‹œ í™œì„±í™”ë¥¼ ìœ„í•´ì„œ ë³„ë„ë¡œ StoryCacheServiceë¥¼ êµ¬í˜„í•˜ì˜€ê³  ë‹¤ë¥¸ í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ë™í™”ì˜ CRUD ì‘ì—…ì„ ì²˜ë¦¬í•˜ë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

ìºì‹œ ì‹œìŠ¤í…œ êµ¬ì¶•ì—ëŠ” ì œê³µë˜ëŠ” @Cacheableê³¼ @CachePut ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì˜€ê³ , ë™í™” IDë¥¼ KEYë¡œ ë™í™” ë‚´ìš©ì„ ìºì‹œí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€ë‹¤.

@Cacheableê³¼ @CachePutì˜ ì—­í• ì€ ì•„ë˜ì™€ ê°™ë‹¤.

- **@Cacheable**
    - ë©”ì„œë“œ í˜¸ì¶œ ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥í•˜ê³ , ì´í›„ ë™ì¼í•œ ë§¤ê°œë³€ìˆ˜ë¡œ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ë©´ ìºì‹œì—ì„œ ê²°ê³¼ë¥¼ ë°˜í™˜
    - ë©”ì„œë“œ ì‹¤í–‰ ì „ì— ìºì‹œë¥¼ ë¨¼ì € í™•ì¸ í›„, ìºì‹œì— ê°’ì´ ì—†ìœ¼ë©´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•œ ë’¤ ê²°ê³¼ë¥¼ ìºì‹œì— ì €ì¥
- **@CachePut**
    - ë©”ì„œë“œ ì‹¤í–‰ ê²°ê³¼ë¥¼ ê°•ì œë¡œ ìºì‹œì— ì €ì¥
    - í•­ìƒ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ë©°, ë°˜í™˜ëœ ê²°ê³¼ë¥¼ ìºì‹œì— ì—…ë°ì´íŠ¸

ìºì‹œë¥¼ ë¹„ìš°ëŠ”ë° ì‚¬ìš©ë˜ëŠ” @CacheEvictë„ ìˆëŠ”ë° ë³¸ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë™í™” ì‚­ì œ ê¸°ëŠ¥ì„ ë³„ë„ë¡œ êµ¬í˜„í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ì§€ëŠ” ì•Šì•˜ë‹¤.

---

## ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

êµ¬ì¶•í•œ ìºì‹œ ì‹œìŠ¤í…œì´ ì–´ëŠ ì •ë„ì˜ ì„±ëŠ¥ì´ ë‚˜ì˜¤ëŠ”ì§€ ê°„ë‹¨í•œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì•˜ë‹¤.

![Image](https://github.com/user-attachments/assets/ae28bc28-24a4-4b93-96d3-01ddbf0bcc78)

í…ŒìŠ¤íŠ¸ì—ëŠ” nGrinderë¥¼ í™œìš©í•˜ì˜€ê³  ë¯¸ë¦¬ 1000ê°œì˜ ë™í™” ë°ì´í„°ë¥¼ ìƒì„± í›„, íŒŒë ˆí† ì˜ ë²•ì¹™ì„ ë”°ë¥´ëŠ” ì¡°íšŒ ìš”ì²­ì„ ë³´ë‚´ë„ë¡ í•˜ì˜€ë‹¤.

í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ëŠ” ì•„ë˜ì™€ ê°™ì´ êµ¬ì„±í•˜ì˜€ë‹¤.

- Agent: 1ëŒ€
- í…ŒìŠ¤íŠ¸ ìœ ì €: 1000
- í…ŒìŠ¤íŠ¸ ì‹œê°„: 1ë¶„
- Ramp-Up (ì‹œê°„ì— ë”°ë¼ ì‚¬ìš©ì ì¦ê°€)

ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì§€í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

- ìºì‹œë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ê²½ìš°

    ![Image](https://github.com/user-attachments/assets/c5ec7208-b990-44ed-a728-d49b405ea691)

- ìºì‹œë¥¼ ì ìš©í•œ ê²½ìš°

    ![Image](https://github.com/user-attachments/assets/2d62e452-b0d2-4438-8ef9-6c0c0f56264a)

|  | **ìºì‹œ ì ìš© X** | **ìºì‹œ ì ìš©** | **ì„±ëŠ¥ ê°œì„ ** |
| --- | --- | --- | --- |
| **TPS** | 141.4 | 224.4 | ì•½ 58.7% ê°œì„  |
| **Mean Test Time** | 1227.27 | 1024.08 | ì•½ 16.6% ê°œì„  |

TPSì˜ ê²½ìš° ì•½ 58.7%ì˜ ì„±ëŠ¥ í–¥ìƒ, í‰ê·  ì‘ë‹µ ì‹œê°„ì˜ ê²½ìš° ì•½ 16.6%ì˜ ì„±ëŠ¥ í–¥ìƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤.

ìƒê°ë³´ë‹¤ëŠ” ë‚®ì€ í­ì˜ ì„±ëŠ¥ í–¥ìƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆëŠ”ë° ì•„ë§ˆ ë™í™” ì¡°íšŒ ìš”ì²­ì—ì„œ í•´ë‹¹ ë™í™”ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ëŠ”ì§€ ë“±ì˜ ì •ë³´ëŠ” ì–´ì©” ìˆ˜ ì—†ì´ ë””ë¹„ì—ì„œ ê°€ì ¸ì™€ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì™”ë˜ ê²ƒ ê°™ë‹¤.

---

## ë§ˆì¹˜ë©°

ì˜ ëª°ëë˜ ìºì‹œì— ëŒ€í•´ì„œ í•™ìŠµí•˜ê³  ì§ì ‘ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³´ë©´ì„œ, ë‚´ê°€ ì„¤ê³„í•œ ì„œë²„ì˜ ì„±ëŠ¥ í–¥ìƒì— ëŒ€í•´ì„œ ê³ ë¯¼í•  ìˆ˜ ìˆì—ˆë˜ ì¢‹ì€ ê²½í—˜ì´ì—ˆë‹¤.

íŠ¹íˆ, ë°ì´í„°ë² ì´ìŠ¤ì™€ ìºì‹œ ê°„ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ì „ëµì˜ ì¤‘ìš”ì„±ì„ ê¹¨ë‹¬ì•˜ê³ , ì‹¤ë¬´ì—ì„œì˜ ìºì‹œ ë„ì…ì„ ìœ„í•´ì„  íš¨ê³¼ì ì¸ ì „ëµ ìˆ˜ë¦½ì´ í•„ìš”í•  ê²ƒì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

ë˜ ì§ì ‘ nGrinderë¥¼ í†µí•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ë©°, ì„±ëŠ¥ ê°œì„  ì‚¬í•­ì„ ìˆ˜ì¹˜ë¡œ í™•ì¸í•  ìˆ˜ ìˆì–´ì„œ ì¢‹ì•˜ë‹¤.
